---
title: IP数据包发送和转发过程
---



# 默认网关

- 跨网络通信需要借助路由器。为了让设备知道路由器，给路由器接口配置一个IP地址。设备指定的路由器接口的IP地址就是默认网关，设备的跨网络通讯都由设备指定的路由器转发，设备的数据都会发送到设备指定的路由器接口IP地址

# 主机发送IP数据报

## 过程

- ==判断目的主机是否与自己在同一网络==
  - 若==在同一网络==，则属于==直接交付==
  - 若==不在同一网络==，则属于==间接交付==，传输给主机所在网络的==默认网关==（路由器），由默认网关帮忙转发

## 判断方法

1. 将本地主机的IP地址与本地机的子网掩码相与，得到本地网络地址。
2. 将目的主机的IP地址与本地主机的子网掩码相与，得到目的网络地址。（从网络角度看，子网不算网段，只有自己才是一个网段。从子网角度看，子网是一个网段。所以判断是否在一个网段，只需要本机的子网掩码，判断他是不是直接连在网络上或是连在子网中）
3. 比较本地网络地址与目的网络地址
   - 若相同，则在同一网络
   - 若不同，则不在同一网络

# 路由器转发IP数据报

## 过程

1. ==检查IP数据报首部是否出错==
   - 若出错，则直接丢弃该IP数据报并通告源主机
   - 若没出错，则进行转发
2. ==根据IP数据报的目的地址在路由表中查找匹配的条目==
   - 若找到匹配的条目，则转发给条目中指示的下一跳
   - 若找不到，则丢弃该IP数据报并通告源主机

## 判断方法

1. 将目的地址与路由表条目中的地址掩码相与得到网络地址
2. 将得到的网络地址与条目中的目的网络地址进行比较
   - 若相同，则匹配
   - 若不同，则不匹配